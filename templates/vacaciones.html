{% extends "base.html" %}
{% block content %}

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

:root{
    --bg-main:#0b0f14;
    --card:#161b22;
    --card-soft:#1f2630;
    --accent:#ff3b3b;
    --yellow:#ffcc00;
    --green:#2ecc71;
    --text:#ffffff;
    --text-soft:#c9d1d9;
    --border:#2b313a;
}

/* ===== BASE ===== */
body{
    background:var(--bg-main);
    font-family:'Inter',sans-serif;
    color:var(--text);
}

/* ===== HEADER MINIMAL ===== */
.clean-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px 40px;
    background:#11161d;
    border-bottom:1px solid var(--border);
}

.clean-header h5{
    margin:0;
    font-weight:600;
    color:var(--text);
}

.btn-dashboard{
    background:transparent;
    border:1px solid var(--border);
    padding:6px 18px;
    border-radius:8px;
    color:var(--text-soft);
    text-decoration:none;
    font-size:.85rem;
    transition:.2s;
}

.btn-dashboard:hover{
    border-color:var(--accent);
    color:white;
}

/* ===== CONTAINER ===== */
.container{
    max-width:1300px;
}

/* ===== CARDS ===== */
.card-custom{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:14px;
    padding:30px;
    margin-bottom:30px;
    box-shadow:0 8px 30px rgba(0,0,0,.4);
}

/* ===== TITULOS ===== */
.section-header{
    font-size:1.1rem;
    font-weight:600;
    margin-bottom:25px;
    color:var(--yellow);
}

/* ===== KPIs ===== */
.kpi-card{
    background:var(--card-soft);
    border:1px solid var(--border);
    border-radius:12px;
    padding:25px;
}

.kpi-title{
    font-size:.75rem;
    text-transform:uppercase;
    color:var(--text-soft);
    letter-spacing:.7px;
}

.kpi-number{
    font-size:2.5rem;
    font-weight:700;
    margin-top:8px;
}

/* ===== FORM ===== */
.form-label{
    font-size:.75rem;
    color:var(--text-soft);
}

.form-control{
    background:var(--card-soft) !important;
    border:1px solid var(--border) !important;
    border-radius:10px !important;
    color:white !important;
    height:45px;
}

.form-control:focus{
    border-color:var(--accent) !important;
    box-shadow:0 0 0 2px rgba(255,59,59,.3) !important;
}

/* ===== CALENDARIO PERSONALIZADO ===== */
input[type="date"]{
    appearance:none;
    position:relative;
    padding-right:40px !important;
}

input[type="date"]::-webkit-calendar-picker-indicator{
    filter:invert(1);
    opacity:.7;
    cursor:pointer;
}

input[type="date"]:hover::-webkit-calendar-picker-indicator{
    opacity:1;
}

/* ===== BOTON REGISTRAR ===== */
.btn-registrar{
    background:var(--accent);
    border:none;
    border-radius:10px;
    padding:10px 28px;
    font-weight:600;
}

.btn-registrar:hover{
    background:#ff5555;
}

/* ===== TEAM CARDS ===== */
.team-card{
    background:var(--card-soft);
    border:1px solid var(--border);
    border-radius:10px;
    padding:14px 18px;
    margin-bottom:10px;
}

/* ===== TABLA ===== */
.table-container{
    overflow-x:auto;
}

.table-oni{
    width:100%;
    border-collapse:collapse;
}

.table-oni th{
    padding:16px;
    font-size:.75rem;
    text-transform:uppercase;
    color:var(--text-soft);
    border-bottom:1px solid var(--border);
}

.table-oni td{
    padding:16px;
    font-size:.95rem;
    border-bottom:1px solid var(--border);
    color:white;
}

.table-oni tbody tr:hover{
    background:rgba(255,255,255,.04);
}

/* ===== BADGES ===== */
.badge-access{
    padding:6px 12px;
    border-radius:20px;
    font-size:.7rem;
    font-weight:600;
}

/* ===== BOTONES ACCIONES ===== */
.action-btn{
    padding:6px 14px;
    border-radius:8px;
    border:none;
    font-size:.75rem;
    font-weight:600;
    margin-right:6px;
}

.btn-edit{
    background:var(--yellow);
    color:black;
}

.btn-delete{
    background:var(--accent);
    color:white;
}

.btn-edit:hover{ opacity:.8; }
.btn-delete:hover{ opacity:.8; }

</style>

<!-- HEADER LIMPIO -->
<div class="clean-header">
    <h5>Gestión de Vacaciones</h5>
    <a href="{{ url_for('dashboard') }}" class="btn-dashboard">
        ← Volver al Dashboard
    </a>
</div>

<div class="container py-5">

<!-- KPIs -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="kpi-card">
            <div class="kpi-title">Vacaciones activas</div>
            <div class="kpi-number">{{ activas|length }}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="kpi-card">
            <div class="kpi-title">Próximas</div>
            <div class="kpi-number" style="color:var(--yellow)">
                {{ proximas|length }}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="kpi-card">
            <div class="kpi-title">Días usados (año)</div>
            <div class="kpi-number">{{ total_dias_anual }}</div>
        </div>
    </div>
</div>

<!-- REGISTRO -->
<div class="card-custom">
    <div class="section-header">Registrar Vacaciones</div>
    <form method="POST" action="{{ url_for('solicitar_vacaciones') }}">
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Empleado</label>
                <select name="user_id" class="form-control" required>
                    <option value="">Seleccionar empleado</option>
                    {% for user in usuarios %}
                    <option value="{{ user.id }}">
                        {{ user.nombre }} ({{ user.dias_vacaciones }} días)
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <label class="form-label">Inicio</label>
                <input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control" required>
            </div>

            <div class="col-md-3">
                <label class="form-label">Fin</label>
                <input type="date" name="fecha_fin" id="fecha_fin" class="form-control" required>
            </div>

            <div class="col-md-3">
                <label class="form-label">Días</label>
                <input type="number" name="dias" id="dias" class="form-control" readonly>
            </div>

            <div class="col-12 text-end">
                <button type="submit" class="btn btn-registrar">
                    Registrar
                </button>
            </div>
        </div>
    </form>
</div>

<!-- HISTORIAL -->
<div class="card-custom mt-4">
    <div class="section-header">Historial General</div>

    <div class="table-container">
        <table class="table-oni">
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Inicio</th>
                    <th>Fin</th>
                    <th>Días</th>
                    <th>Estado</th>
                    <th>Autor</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for v in vacaciones %}
                <tr>
                    <td><strong>{{ v.user.nombre }}</strong></td>
                    <td>{{ v.fecha_inicio }}</td>
                    <td>{{ v.fecha_fin }}</td>
                    <td style="color:var(--yellow); font-weight:600">
                        {{ v.dias_solicitados }}
                    </td>
                    <td>
                        {% if v.estado == "Aprobado" %}
                        <span class="badge-access" style="background:var(--green)">Aprobado</span>
                        {% elif v.estado == "Pendiente" %}
                        <span class="badge-access" style="background:var(--yellow); color:black;">Pendiente</span>
                        {% else %}
                        <span class="badge-access" style="background:var(--accent)">Rechazado</span>
                        {% endif %}
                    </td>
                    <td>{{ v.registrado_por or "-" }}</td>
                    <td>
                        <a href="{{ url_for('edit_vacacion', id=v.id) }}" class="action-btn btn-edit">
                            Editar
                        </a>
                        <button onclick="eliminarVacacion({{ v.id }})" class="action-btn btn-delete">
                            Eliminar
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

</div>

<script>
const inicio = document.getElementById("fecha_inicio");
const fin = document.getElementById("fecha_fin");
const diasInput = document.getElementById("dias");

function calcularDias() {
    if (inicio.value && fin.value) {
        const fechaInicio = new Date(inicio.value);
        const fechaFin = new Date(fin.value);
        const diff = (fechaFin - fechaInicio) / (1000 * 60 * 60 * 24) + 1;
        diasInput.value = diff > 0 ? diff : 0;
    }
}

inicio.addEventListener("change", calcularDias);
fin.addEventListener("change", calcularDias);

function eliminarVacacion(id) {
    if (confirm("¿Seguro que deseas eliminar esta vacación?")) {
        window.location.href = "/delete_vacacion/" + id;
    }
}
</script>

{% endblock %}