{% extends "base.html" %}
{% block content %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

:root{
    --bg-main:#0b0f14;
    --bg-card:#121821;
    --bg-soft:#1a2230;
    --accent:#e10600;
    --accent-yellow:#ffc107;
    --text-main:#ffffff;
    --text-muted:#a0a8b3;
    --border:#263042;
}

/* ===== BASE ===== */
body{
    background:linear-gradient(135deg,#0b0f14,#0f1621);
    font-family:'Inter',sans-serif;
    color:var(--text-main);
}

/* ===== HEADER NUEVO ===== */
.top-header{
    background:rgba(18,24,33,.95);
    backdrop-filter:blur(10px);
    border-bottom:1px solid var(--border);
    padding:18px 40px;
    margin-bottom:40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.top-header h1{
    font-size:1.4rem;
    font-weight:700;
    margin:0;
}

.btn-dashboard{
    background:var(--bg-soft);
    border:1px solid var(--border);
    color:var(--text-main);
    padding:8px 18px;
    border-radius:8px;
    text-decoration:none;
    transition:.2s;
    font-weight:600;
}

.btn-dashboard:hover{
    border-color:var(--accent);
    color:var(--accent);
}

/* ===== CARDS ===== */
.card-custom{
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:14px;
    padding:35px;
    margin-bottom:30px;
    box-shadow:0 10px 35px rgba(0,0,0,.45);
}

/* ===== TITULOS ===== */
.section-header{
    font-size:1.2rem;
    font-weight:700;
    margin-bottom:25px;
    padding-bottom:12px;
    border-bottom:1px solid var(--border);
    color:var(--accent-yellow);
}

/* ===== KPI ===== */
.kpi-card{
    background:linear-gradient(145deg,#151c27,#1c2533);
    border:1px solid var(--border);
    border-radius:14px;
    padding:30px;
    transition:.25s;
}

.kpi-card:hover{
    transform:translateY(-4px);
    border-color:var(--accent);
}

.kpi-title{
    font-size:.8rem;
    color:var(--text-muted);
    text-transform:uppercase;
    letter-spacing:1px;
}

.kpi-number{
    font-size:2.8rem;
    font-weight:800;
    margin-top:10px;
}

/* ===== FORM ===== */
.form-label{
    font-size:.75rem;
    color:var(--text-muted);
    font-weight:600;
}

.form-control{
    background:var(--bg-soft) !important;
    border:1px solid var(--border) !important;
    border-radius:10px !important;
    color:#fff !important;
    padding:10px;
}

.form-control:focus{
    border-color:var(--accent) !important;
    box-shadow:0 0 0 2px rgba(225,6,0,.3) !important;
}

/* ===== CALENDARIO MEJORADO ===== */
input[type="date"]::-webkit-calendar-picker-indicator{
    filter:invert(1);
    opacity:.8;
    cursor:pointer;
}

input[type="date"]{
    position:relative;
}

input[type="date"]:hover{
    border-color:var(--accent) !important;
}

/* ===== BOTON REGISTRAR ===== */
.btn-registrar{
    background:linear-gradient(90deg,#e10600,#ff2a2a);
    border:none;
    border-radius:10px;
    padding:10px 30px;
    font-weight:700;
    transition:.2s;
}

.btn-registrar:hover{
    transform:scale(1.05);
}

/* ===== TEAM CARDS ===== */
.team-card{
    background:var(--bg-soft);
    border:1px solid var(--border);
    border-radius:12px;
    padding:18px 22px;
    margin-bottom:12px;
    transition:.2s;
    font-size:.95rem;
}

.team-card:hover{
    border-color:var(--accent);
    transform:translateX(4px);
}

/* ===== TABLA ===== */
.table-oni{
    width:100%;
    border-collapse:collapse;
}

.table-oni thead{
    background:#18202c;
}

.table-oni th{
    padding:18px;
    font-size:.75rem;
    text-transform:uppercase;
    letter-spacing:1px;
    color:#c9d1d9;
    border-bottom:1px solid var(--border);
}

.table-oni td{
    padding:18px;
    border-bottom:1px solid var(--border);
    font-size:.95rem;
}

.table-oni tbody tr:hover{
    background:rgba(255,255,255,.04);
}

/* ===== BADGES ===== */
.badge-access{
    padding:7px 14px;
    border-radius:30px;
    font-size:.75rem;
    font-weight:700;
}

/* ===== BOTONES ACCION ===== */
.action-btn{
    background:var(--bg-soft);
    border:1px solid var(--border);
    color:#fff;
    padding:6px 10px;
    border-radius:8px;
    transition:.2s;
}

.action-btn:hover{
    background:var(--accent);
    border-color:var(--accent);
}

.action-btn i{
    font-size:.9rem;
}
</style>
<!-- HEADER LIMPIO -->
<div class="clean-header">
    <h5>Gestión de Vacaciones</h5>
    <a href="{{ url_for('dashboard') }}" class="btn-dashboard">
        ← Volver al Dashboard
    </a>
</div>

<div class="container py-5">

<!-- KPIs -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="kpi-card">
            <div class="kpi-title">Vacaciones activas</div>
            <div class="kpi-number">{{ activas|length }}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="kpi-card">
            <div class="kpi-title">Próximas</div>
            <div class="kpi-number" style="color:var(--yellow)">
                {{ proximas|length }}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="kpi-card">
            <div class="kpi-title">Días usados (año)</div>
            <div class="kpi-number">{{ total_dias_anual }}</div>
        </div>
    </div>
</div>

<!-- REGISTRO -->
<div class="card-custom">
    <div class="section-header">Registrar Vacaciones</div>
    <form method="POST" action="{{ url_for('solicitar_vacaciones') }}">
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Empleado</label>
                <select name="user_id" class="form-control" required>
                    <option value="">Seleccionar empleado</option>
                    {% for user in usuarios %}
                    <option value="{{ user.id }}">
                        {{ user.nombre }} ({{ user.dias_vacaciones }} días)
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <label class="form-label">Inicio</label>
                <input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control" required>
            </div>

            <div class="col-md-3">
                <label class="form-label">Fin</label>
                <input type="date" name="fecha_fin" id="fecha_fin" class="form-control" required>
            </div>

            <div class="col-md-3">
                <label class="form-label">Días</label>
                <input type="number" name="dias" id="dias" class="form-control" readonly>
            </div>

            <div class="col-12 text-end">
                <button type="submit" class="btn btn-registrar">
                    Registrar
                </button>
            </div>
        </div>
    </form>
</div>

<!-- HISTORIAL -->
<div class="card-custom mt-4">
    <div class="section-header">Historial General</div>

    <div class="table-container">
        <table class="table-oni">
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Inicio</th>
                    <th>Fin</th>
                    <th>Días</th>
                    <th>Estado</th>
                    <th>Autor</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for v in vacaciones %}
                <tr>
                    <td><strong>{{ v.user.nombre }}</strong></td>
                    <td>{{ v.fecha_inicio }}</td>
                    <td>{{ v.fecha_fin }}</td>
                    <td style="color:var(--yellow); font-weight:600">
                        {{ v.dias_solicitados }}
                    </td>
                    <td>
                        {% if v.estado == "Aprobado" %}
                        <span class="badge-access" style="background:var(--green)">Aprobado</span>
                        {% elif v.estado == "Pendiente" %}
                        <span class="badge-access" style="background:var(--yellow); color:black;">Pendiente</span>
                        {% else %}
                        <span class="badge-access" style="background:var(--accent)">Rechazado</span>
                        {% endif %}
                    </td>
                    <td>{{ v.registrado_por or "-" }}</td>
                    <td>
                        <a href="{{ url_for('edit_vacacion', id=v.id) }}" class="action-btn btn-edit">
                            Editar
                        </a>
                        <button onclick="eliminarVacacion({{ v.id }})" class="action-btn btn-delete">
                            Eliminar
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

</div>

<script>
const inicio = document.getElementById("fecha_inicio");
const fin = document.getElementById("fecha_fin");
const diasInput = document.getElementById("dias");

function calcularDias() {
    if (inicio.value && fin.value) {
        const fechaInicio = new Date(inicio.value);
        const fechaFin = new Date(fin.value);
        const diff = (fechaFin - fechaInicio) / (1000 * 60 * 60 * 24) + 1;
        diasInput.value = diff > 0 ? diff : 0;
    }
}

inicio.addEventListener("change", calcularDias);
fin.addEventListener("change", calcularDias);

function eliminarVacacion(id) {
    if (confirm("¿Seguro que deseas eliminar esta vacación?")) {
        window.location.href = "/delete_vacacion/" + id;
    }
}
</script>

{% endblock %}